{# templates/admin/dashboard.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Astraso Admin
{% endblock %}

{% block body %}
	{% block navbar %}
		{{ parent() }}
	{% endblock %}
	{% block content %}
		<style>
			body {
				height: 0;
			}
		</style>
		<div style="height:100px; width: 100px"></div><br>
		<h1>Tableau de bord</h1>
		<div class="accordion accordion-flush" id="accordionFlushExample" style="width: fit-content;">
			<div class="accordion-item">
				<h2 class="accordion-header" id="flush-headingOne">
					<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
						Reports
					</button>
				</h2>
				<div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
					<div class="accordion-body">
						<table class="table">
							<thead>
								<tr>
									<th scope="col">#</th>
									<th scope="col">Raison</th>
									<th scope="col">Descriptif</th>
									<th scope="col">Reporter</th>
									<th scope="col">Post ou Utilisateurs Report</th>
									<th scope="col">Date</th>
									<th scope="col">Action</th>
								</tr>
							</thead>
							<tbody>
								{% for report in reports %}
									<tr>
										<th scope="row">{{ report.id }}</th>
										<td>{{ report.reason.name }}</td>
										<td>{{ report.description }}</td>
										<td>{{ report.userReporter.username }}</td>
										<td>
											{% if report.post is not null %}
												<a href="{{ path('app_single_post', {'id': report.post.id}) }}">{{ report.post.title }}</a>
											{% elseif report.userReported is not null %}
												<a href="{{ path('app_user_show', {'id': report.userReported.id}) }}">{{ report.userReported.username }}</a>
											{% else %}
												N/A
											{% endif %}
										</td>
										<td>{{ report.createdAt|date('d/m/Y') }}</td>
										<td>
											<form method="post" action="{{ path('app_report_delete', {'id': report.id}) }}" style="display:inline;">
												<input type="hidden" name="_token" value="{{ csrf_token('accept' ~ report.id) }}">
												<button class="btn btn-success">Régler</button>
											</form>
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="accordion-item">
				<h2 class="accordion-header" id="flush-headingTwo">
					<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
						Demandes d'établissements en attente d'acceptation
					</button>
				</h2>
				<div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo" data-bs-parent="#accordionFlushExample">
					<div class="accordion-body">
						<table class="table">
							<thead>
								<tr>
									<th scope="col">#</th>
									<th scope="col">Nom</th>
									<th scope="col">Code Postal</th>
									<th scope="col">Adresse</th>
									<th scope="col">Actions</th>
								</tr>
							</thead>
							<tbody>
								{% for institution in institutions %}
									{% if institution.accepted != true %}
										<tr>
											<th scope="row">{{ institution.id }}</th>
											<td>{{ institution.name }}</td>
											<td>{{ institution.postalCode }}</td>
											<td>{{ institution.address }}</td>
											<td>
												<form method="post" action="{{ path('app_institution_accept', {'id': institution.id}) }}" style="display:inline;">
													<input type="hidden" name="_token" value="{{ csrf_token('accept' ~ institution.id) }}">
													<button class="btn btn-success">Accepter</button>
												</form>
												<form method="post" action="{{ path('app_institution_delete', {'id': institution.id}) }}" style="display:inline;">
													<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ institution.id) }}">
													<button class="btn btn-danger">Supprimer</button>
												</form>
											</td>
										</tr>
									{% endif %}
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	{% endblock %}
{% endblock %}
